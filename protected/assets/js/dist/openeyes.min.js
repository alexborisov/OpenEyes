/*! openeyes 11-12-2014 */
!function(a){a.OpenEyes={}}(this),function(a){var b={};b.inherits=function(a,b){return b._super=a,b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b},a.Util=b}(this.OpenEyes),function(a){function b(){this.events={}}b.prototype.on=function(a,b){var c=this.events;return c[a]||(c[a]=[]),c[a].push(b),this},b.prototype.off=function(a,b){var c=this.events[a];return c&&(b?c.splice(c.indexOf(b),1):c=[],c.length||delete this.events[a]),this},b.prototype.emit=function(a,b){var c,d=(this.events[a]||[]).slice();if(d.length)for(;c=d.shift();)c.call(this,b);return this.trigger(a,b)},b.prototype.bindAll=function(a){OpenEyes.Util.bindAll(this,a)},b.prototype.trigger=function(a,b){if(this.options){var c="on"+a.slice(0,1).toUpperCase()+a.slice(1),d=this.options[c];return d&&d.call(this,b),this}},a.EventEmitter=b}(this.OpenEyes.Util),function(a){a.UI={}}(this.OpenEyes),function(a){function b(a,c){this.element=$(a),this.element.length&&(this.options=$.extend({},b._defaultOptions,c),this.elementOffset=this.element.offset(),this.wrapperHeight=this.options.wrapperHeight(this),this.wrapElement(),this.bindEvents())}var c="sticky",d=$(window);b._defaultOptions={wrapperClass:"sticky-wrapper",stuckClass:"stuck",offset:0,debug:!1,wrapperHeight:function(a){return a.element.height()},enableHandler:function(a){a.enable()},disableHandler:function(a){a.disable()}},b.prototype.wrapElement=function(){this.element.wrap($("<div />",{"class":this.options.wrapperClass})),this.wrapper=this.element.parent()},b.prototype.bindEvents=function(){d.on("scroll."+c,this.onWindowScroll.bind(this))},b.prototype.enable=function(){this.wrapper.height(this.wrapperHeight),this.element.addClass(this.options.stuckClass)},b.prototype.disable=function(){this.wrapper.height("auto"),this.element.removeClass(this.options.stuckClass)},b.prototype.onWindowScroll=function(){var a=$.isFunction(this.options.offset)?this.options.offset():this.options.offset,b=d.scrollTop(),c=this.elementOffset.top+a,e=$(document).height()-d.height();b>e&&(b-=b-e),b>=c?this.options.enableHandler(this):this.options.disableHandler(this)},a.StickyElement=b,a.StickyElements={refresh:function(){d.trigger("scroll."+c)}}}(this.OpenEyes.UI),function(a,b,c){"use strict";function d(a){c.call(this),this.options=$.extend(!0,{},d._defaultOptions,a),this.create()}d.prototype=Object.create(c.prototype),d._defaultOptions={className:"quicklook tooltip",content:"",offset:{x:0,y:0},viewPortOffset:{x:0,y:0}},d.prototype.create=function(){this.container=$("<div />",{"class":this.options.className}).appendTo(document.body),this.setContent(this.options.content)},d.prototype.setContent=function(a){this.container.html(a)},d.prototype.show=function(a,b){this.container.css(this.getPosition(a,b))},d.prototype.getPosition=function(a,b){this.container.show();var c=this.options,d=a-$(window).scrollLeft(),e=b-$(window).scrollTop(),f=$(window).width(),g=$(window).height(),h=this.container.outerWidth(),i=this.container.outerHeight();return h+d+c.offset.x+c.viewPortOffset.x>=f?a-=h+c.offset.x:a+=c.offset.x,i+e+c.offset.y+c.viewPortOffset.y>=g?b-=i+c.offset.y:b+=c.offset.y,{left:a,top:b}},d.prototype.hide=function(){this.container.hide()},d.prototype.destroy=function(){this.container.empty().remove()},a.Tooltip=d}(OpenEyes.UI,OpenEyes.Util,EventEmitter2),function(a,b,c){"use strict";function d(a){c.call(this),this.options=$.extend(!0,{},d._defaultOptions,a),this.create(),this.bindEvents(),this.options.iframe?this.loadIframeContent():this.options.url&&this.loadContent()}$.extend($.ui.dialog.prototype.options,{dialogClass:"dialog",show:"fade"}),b.inherits(c,d),d._defaultOptions={content:null,destroyOnClose:!0,url:null,data:null,id:null,iframe:null,autoOpen:!1,title:null,modal:!0,dialogClass:"dialog",resizable:!1,draggable:!1,constrainToViewport:!1,width:440,height:"auto",minHeight:"auto",show:"fade"},d.prototype.create=function(){this.content=$("<div />",{id:this.options.id}),this.setContent(this.options.content),this.content.dialog(this.options),this.instance=this.content.data("ui-dialog")},d.prototype.setContent=function(a){if("function"==typeof this.getContent){var b=$.extend({},this.options,{content:a});a=this.getContent(b)}this.content.html(a)},d.prototype.bindEvents=function(){this.content.on({dialogclose:this.onDialogClose.bind(this),dialogopen:this.onDialogOpen.bind(this)})},d.prototype.compileTemplate=function(a){var b=$(a.selector).html();if(!b)throw new Error("Unable to compile dialog template. Template not found: "+a.selector);return Mustache.render(b,a.data||{})},d.prototype.setLoadingState=function(){this.content.addClass("loading"),this.setTitle("Loading...")},d.prototype.removeLoadingState=function(){this.content.removeClass("loading")},d.prototype.loadContent=function(){this.setLoadingState(),this.xhr=$.ajax({url:this.options.url,data:this.options.data}),this.xhr.done(this.onContentLoadSuccess.bind(this)),this.xhr.fail(this.onContentLoadFail.bind(this)),this.xhr.always(this.onContentLoad.bind(this))},d.prototype.loadIframeContent=function(){this.setLoadingState(),this.iframe=$("<iframe />",{width:"100%",height:"99%",frameborder:0}).hide(),this.iframe.on("load",this.onIframeLoad.bind(this)),this.iframe.attr({src:this.options.iframe}),this.setContent(this.iframe)},d.prototype.setTitle=function(a){this.instance.option("title",a)},d.prototype.reposition=function(){this.instance._position(this.instance._position())},d.prototype.getDimensions=function(){var a={width:this.options.width,height:this.options.height};if(this.options.constrainToViewport){var b=this.getActualDimensions(),c=40;a.width=Math.min(b.width,$(window).width()-c),a.height=Math.min(b.height,$(window).height()-c)}return a},d.prototype.getActualDimensions=function(){var a=this.instance.isOpen(),b=this.options.destroyOnClose;a||(this.options.destroyOnClose=!1,this.instance.open());var c={width:parseInt(this.options.width,10)||this.instance.uiDialog.outerWidth(),height:parseInt(this.options.height,10)||this.instance.uiDialog.outerHeight()};return a||(this.instance.close(),this.options.destroyOnClose=b),c},d.prototype.setDimensions=function(){var a=this.getDimensions();this.instance.option("width",a.width),this.instance.option("height",a.height)},d.prototype.open=function(){this.setDimensions(),this.instance.open(),this.reposition()},d.prototype.close=function(){this.instance.close()},d.prototype.destroy=function(){this.xhr&&this.xhr.abort(),this.iframe&&this.iframe.remove(),this.instance.destroy(),this.content.remove(),this.emit("destroy")},d.prototype.onDialogOpen=function(){this.emit("open")},d.prototype.onDialogClose=function(){this.emit("close"),this.options.destroyOnClose&&this.destroy()},d.prototype.onContentLoad=function(){this.removeLoadingState(),this.setDimensions(),this.reposition()},d.prototype.onContentLoadSuccess=function(a){this.setTitle(this.options.title),this.setContent(a)},d.prototype.onContentLoadFail=function(){this.setTitle("Error"),this.setContent("Sorry, there was an error retrieving the content. Please try again.")},d.prototype.onIframeLoad=function(){this.setTitle(this.options.title),this.iframe.show(),this.onContentLoad()},a.Dialog=d}(OpenEyes.UI,OpenEyes.Util,OpenEyes.Util.EventEmitter),function(a,b){"use strict";function c(a){a=$.extend(!0,{},c._defaultOptions,a),d.call(this,a)}var d=a;b.inherits(d,c),c._defaultOptions={modal:!0,width:400,minHeight:"auto",title:"Alert",dialogClass:"dialog alert"},c.prototype.getContent=function(a){return a.content=(a.content||"").replace(/\n/g,"<br/>"),this.compileTemplate({selector:"#dialog-alert-template",data:{content:a.content}})},c.prototype.bindEvents=function(){d.prototype.bindEvents.apply(this,arguments),this.content.on("click",".ok",this.onButtonClick.bind(this))},c.prototype.onButtonClick=function(){this.close(),this.emit("ok")},a.Alert=c}(OpenEyes.UI.Dialog,OpenEyes.Util),function(a,b){"use strict";function c(a){a=$.extend(!0,{},c._defaultOptions,a),a.content=a.url?"":a.content,d.call(this,a)}var d=a;b.inherits(d,c),c._defaultOptions={modal:!0,width:400,minHeight:"auto",title:"Confirm",dialogClass:"dialog confirm",okButton:"OK",cancelButton:"Cancel"},c.prototype.getContent=function(a){return this.compileTemplate({selector:"#dialog-confirm-template",data:{content:a.content,okButton:a.okButton,cancelButton:a.cancelButton}})},c.prototype.bindEvents=function(){d.prototype.bindEvents.apply(this,arguments),this.content.on("click",".ok",this.onOKButtonClick.bind(this)),this.content.on("click",".cancel",this.onCancelButtonClick.bind(this))},c.prototype.onDialogClose=function(a){d.prototype.onDialogClose.apply(this,arguments),a&&a.keyCode&&27===a.keyCode&&this.emit("cancel"),$(a.srcElement).hasClass("ui-dialog-titlebar-close")&&this.emit("cancel")},c.prototype.onOKButtonClick=function(){this.close(),this.emit("ok")},c.prototype.onCancelButtonClick=function(){this.close(),this.emit("cancel")},c.prototype.onContentLoadSuccess=function(a){this.options.content=a,d.prototype.onContentLoadSuccess.call(this,this.getContent(this.options))},a.Confirm=c}(OpenEyes.UI.Dialog,OpenEyes.Util),function(a){a.Widgets={}}(this.OpenEyes.UI),function(a,b,c){"use strict";function d(a){c.call(this),this.options=$.extend(!0,{},d._defaultOptions,a)}b.inherits(c,d),d._defaultOptions={title:"Field Images",images:null,idToImages:null,dialogInstance:null},d.prototype.createDiag=function(a){this.options.dialog=new OpenEyes.UI.Dialog({title:this.options.title,content:this.createImagesDiv(this.options.idToImages[a],a)}),this.options.dialog.open()},d.prototype.createImagesDiv=function(a,b){var c=$("<div/>",{"class":"fieldsWrapper"});for(var d in a.selects){var e=null;a.id in this.options.images&&d in this.options.images[a.id]&&(e=this.options.images[a.id][d]);var f=$("<div/>",{"class":"ui-field-image"}).click({selectId:b,val:d,fieldImgInstance:this},function(a){$("#"+a.data.selectId).val(a.data.val),a.data.fieldImgInstance.options.dialog.close()}),g=$('<p class="ui-field-image-val">'+d+"</p>");e?($(f).css("background-image","url("+e+")"),$(g).appendTo(f)):($(f).css("background-color","#999"),$(g).appendTo(f),$('<p class="ui-field-image-no-preview">No Preview</p>').appendTo(f)),$(f).appendTo(c)}return c},d.prototype.setFieldButtons=function(){for(var a in this.options.idToImages)if($("#"+a)){this.options.idToImages[a],$("<img/>",{id:a+"_cog",src:OE_core_asset_path+"/img/_elements/icons/event/small/images_photo.png",alt:"Opens "+a+" field images","class":"ui-field-images-icon"}).insertAfter("#"+a);var b=this;$("#"+a+"_cog").click(function(){var a=this.id.substr(0,this.id.length-4);b.createDiag(a)})}},a.FieldImages=d}(OpenEyes.UI,OpenEyes.Util,OpenEyes.Util.EventEmitter);