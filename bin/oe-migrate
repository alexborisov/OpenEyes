#!/bin/bash
CSDIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
. "$CSDIR/ciFunctions.sh"

# Find yiic
while [ "$PWD" != "/" ];
do
	if [ -f ./protected/yiic ]; then break;	fi
	cd ..
done
if [ ! -f ./protected/yiic ]; then
	echo "Cannot find OpenEyes root (looking for yiic)"
	exit 1
fi
echo "Found OpenEyes root"

interactiveVal=1
interactiveArg=$(argValue --interactive)
echo Interactive arg : "$interactiveArg"
if [ "$interactiveArg" == "0" ]
then
    interactiveVal=0
    echo "Running in --interactive=0"
fi

cd protected
echo "Migrating OpenEyes..."
./yiic migrate --interactive=$interactiveVal
echo "Migrating Modules..."
./yiic migratemodules --interactive=$interactiveVal
